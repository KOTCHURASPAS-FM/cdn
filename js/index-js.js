$(document).ready(function(){var a=$("#channel"),t=$("#nexttrack"),e=$("#prevtrack"),s=($("#control"),$("#pleer")),i=$("#curtime"),r=$("#audio"),n=$("#volume"),c=$("#channel-info"),l=$("#loading"),o=setInterval(function(){},1e3);function u(a){var t=new Date(a),e=String(t.getMinutes()),s=String(t.getSeconds());return(e=1==e.length?"0"+e:e)+":"+(s=1==s.length?"0"+s:s)}function f(){document.title="#KOTCHURASPAS.FM - Радио",c.fadeOut("fast",function(){l.fadeIn("fast",function(){});var n=$("#channel-selector :selected"),p=new XMLHttpRequest;p.open("POST","/getplay",!0),p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.timeout=5e3,p.ontimeout=function(a){var t;t=n.data("name"),AddNotify('{"header":"Ошибка","msg":"Не удалось подключиться к каналу <b>'+t+'</b>!","type":"danger"}'),l.fadeOut("fase",function(){}),r.attr("src","")},p.send("channel="+n.data("ip")+":"+n.data("port")),p.onreadystatechange=function(){if(4==p.readyState&&200==p.status){var d=JSON.parse(p.responseText),T=d.CurrentTrack.CurrentPos;document.title="#KOTCHURASPAS.FM - "+n.data("name"),s.attr("max",d.CurrentTrack.DurationTimestamp),s.val(T),i.text(u(T)),r.attr("src")!="http://"+n.data("ip")+":"+n.data("port")&&r.attr("src","http://"+n.data("ip")+":"+n.data("port")),a.empty(),a.append('<h4 class="title is-4"><i class="fas fa-play"></i> Сейчас играет:</h4>'),""!=d.CurrentTrack.Artist&&a.append('<h6 class="title is-6"><i class="fas fa-user"></i> Исполнитель: '+d.CurrentTrack.Artist+"</h6>"),""!=d.CurrentTrack.Title&&a.append('<h6 class="title is-6"><i class="fas fa-music"></i> Название: '+d.CurrentTrack.Title+"</h6>"),""==d.CurrentTrack.Artist&&""==d.CurrentTrack.Title&&""!=d.CurrentTrack.CastTitle&&a.append('<h6 class="title is-6"><i class="fas fa-music"></i> Название: '+d.CurrentTrack.CastTitle+"</h6>"),a.append('<h6 class="title is-6"><i class="fas fa-clock"></i> Длительность: '+d.CurrentTrack.Duration+"</h6>"),a.fadeIn("fast",function(){}),t.empty(),t.append('<h4 class="title is-4"><i class="fas fa-forward"></i> Следующий трек:</h4>'),""!=d.NextTrack.Artist&&t.append('<h6 class="title is-6"><i class="fas fa-user"></i> Исполнитель: '+d.NextTrack.Artist+"</h6>"),""!=d.NextTrack.Title&&t.append('<h6 class="title is-6"><i class="fas fa-music"></i> Название: '+d.NextTrack.Title+"</h6>"),t.append('<h6 class="title is-6"><i class="fas fa-clock"></i> Длительность: '+d.NextTrack.Duration+"</h6>"),t.fadeIn("fast",function(){}),e.empty(),e.append('<h4 class="title is-4"><i class="fas fa-backward"></i> Предидущий трек:</h4>'),""!=d.PreviousTrack.Artist&&e.append('<h6 class="title is-6"><i class="fas fa-user"></i> Исполнитель: '+d.PreviousTrack.Artist+"</h6>"),""!=d.PreviousTrack.Title&&e.append('<h6 class="title is-6"><i class="fas fa-music"></i> Название: '+d.PreviousTrack.Title+"</h6>"),""==d.PreviousTrack.Artist&&""==d.PreviousTrack.Title&&""!=d.PreviousTrack.CastTitle&&e.append('<h6 class="title is-6"><i class="fas fa-music"></i> Название: '+d.PreviousTrack.CastTitle+"</h6>"),e.append('<h6 class="title is-6"><i class="fas fa-clock"></i> Длительность: '+d.PreviousTrack.Duration+"</h6>"),e.fadeIn("fast",function(){}),clearInterval(o),o=setInterval(function(){var a=u(T+=1e3);i.append('<i class="fas fa-clock"></i> '),i.text(a),s.val(T),a==d.CurrentTrack.Duration&&f()},1e3),l.fadeOut("fast",function(){c.fadeIn("fast",function(){})})}}})}void 0===$.cookie("volume")?r.prop("volume",.5):(r.prop("volume",$.cookie("volume")),n.val($.cookie("volume"))),n.on("input",function(){r.prop("volume",n.val()),$.cookie("volume",n.val())}),$("#channel-selector").on("change",function(){f()})});
